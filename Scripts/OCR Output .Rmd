---
title: "OCR Output"
author: "Kyi Yeung Goh"
date: "07/08/2019"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(stringr)
OCR_scrape<-read.delim2("nypl_cd1880_mtn_sample.txt")
colnames(OCR_scrape)[1]<-"string"
## insert comma after first full stop 

## First, begin by splitting into relevant columns

OCR_scrape$string<-sub("\\.[^.](?=[a-z])", ".,", OCR_scrape$string, perl=TRUE)
OCR_scrape$string<-sub("\\.[^.](?=[0-9])", ".,", OCR_scrape$string, perl=TRUE)


OCR_sep<-as.data.frame(str_split_fixed(OCR_scrape$string, ",",n=3))
OCR_sep$V3[OCR_sep$V3== ""] <- "NA"
OCR_sep$V2[OCR_sep$V2== ""] <- "NA"

## if both V2 and V3 are NA then assign value of 1

for (i in 1:nrow(OCR_sep)){
if ((is.na(OCR_sep$V2[i])&is.na(OCR_sep$V3[i]))==TRUE){
  OCR_sep$fullstr[i]<-1
}else{
  OCR_sep$fullstr[i]<-0
}
}

OCR_scrape<-cbind(OCR_scrape,OCR_sep)
OCR_scrape<-OCR_scrape%>%
  dplyr::select(string,fullstr)

### create a loop then combines previous row and incomplete entry if it is flagged as '1' 
for (i in 1:nrow(OCR_scrape)){
if (OCR_scrape$fullstr[i]==1){
 OCR_scrape$string[i-1]<-paste(OCR_scrape$string[i-1],OCR_scrape$string[i])
}else{
  OCR_scrape$string[i]<-OCR_scrape$string[i]
}
}

### filter out complete cases
OCR_scrape<-OCR_scrape%>%
  dplyr::filter(fullstr==0)%>%
  dplyr::select(-fullstr)

### Re-split complete cases
OCR_sep<-as.data.frame(str_split_fixed(OCR_scrape$string, ",",n=3))

```
